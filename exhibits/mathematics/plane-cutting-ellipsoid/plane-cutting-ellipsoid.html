<!DOCTYPE html>
<html>
<head>
<title>Plane Cutting Ellipsoid</title>
<meta charset=utf-8>
<meta name=viewport content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
<meta name=author content=''>
<style>
	body { margin: 0px; overflow: hidden; }
  
</style>
</head>

<body>

<script src=http://rawgit.com/mrdoob/three.js/r71/build/three.min.js></script>
<script src=http://rawgit.com/mrdoob/three.js/r71/examples/js/controls/OrbitControls.js></script>

<div style='margin: .25in; position: absolute'>
Plane rotation: <input type=range id=planeRotation min=0 max=3.14 step=0.01 value=1.4 oninput='rotatePlane(planeRotation.value)'/><br/>
<input type=button value='Derotate plane' onclick=''/>
<input type=button value='Toggle axes' onclick='axes.visible = !axes.visible'/><br/>
Scale X: <input type=range id=scaleX min=0 max=3 step=0.01 value=1 oninput='ellipse.scale.x = scaleX.value'/><br/>
Scale Y: <input type=range id=scaleY min=0 max=3 step=0.01 value=1.7 oninput='ellipse.scale.y = scaleY.value'/><br/>
Scale Z: <input type=range id=scaleZ min=0 max=3 step=0.01 value=1 oninput='ellipse.scale.z = scaleZ.value'/>
</div>

<script>

	var scene = new THREE.Scene();
	var renderer = new THREE.WebGLRenderer( { antialias: true } );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor( 0xffffff );
	document.body.appendChild( renderer.domElement ); 
	
	var axes = new THREE.AxisHelper( 2 );
	scene.add( axes );
	
	var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 ); 
	camera.up.set( 0, 0, 1 );
	camera.position.set( 2, 2, 2 ); 
	var controls = new THREE.OrbitControls( camera, renderer.domElement );
	
	scene.add( camera ); // critical for adding children to camera

	var planeGeometry = new THREE.PlaneGeometry( 5, 5 );
	var plane = new THREE.Mesh( planeGeometry, new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide } ) );
	plane.position.set( 0, 0, -2 * Math.sqrt(3) ); // move plane to origin relative to camera
	rotatePlane( planeRotation.value );
	camera.add( plane );

	function rotatePlane( angle ) {

		if ( angle < Math.PI/2 ) {
			
			plane.rotation.x = -angle;
			plane.rotation.y = angle;
			
		} else {

			plane.rotation.x = angle;
			plane.rotation.y = -angle;
		
		}
		
	}

	window.addEventListener( 'resize', function() {
		
		renderer.setSize( window.innerWidth, window.innerHeight );
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		
	} );
	
	var ellipsoidGeometry = new THREE.SphereGeometry( 1, 100, 50 );
	var ellipse = new THREE.Mesh( ellipsoidGeometry, new THREE.MeshNormalMaterial() );
	ellipse.scale.x = scaleX.value;
	ellipse.scale.y = scaleY.value;
	ellipse.scale.z = scaleZ.value;
	scene.add( ellipse );

	function render() {
		
		requestAnimationFrame( render ); 
		renderer.render( scene, camera );
		controls.update();
		
	}
	
	// initialize render
	render();
</script>

</body>
</html>
